<!DOCTYPE html>
<html>
<head>
    <title>Simple Markers</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script src="./Scripts/data.js"></script>
    <script src="./Scripts/app.js"></script>
    <script src="./Scripts/jquery-3.3.1.min.js"></script>
    <script src="./Scripts/jquery.signalR-2.4.1.js"></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4xE7VpfxqbdKcH19lze4LDxHX4e5nqLU&callback=initMap&libraries=&v=weekly" defer></script>

    <script src="./Scripts/signalr.js"></script>
   
    <script type="text/javascript">
        $(function () {

          


            const connection = new signalR.HubConnectionBuilder()
                .withUrl("/notificationhub")
                .configureLogging(signalR.LogLevel.Information)
                .build();

            async function start() {
                try {
                    await connection.start();
                    console.log("SignalR Connected.");
                } catch (err) {
                    console.log(err);
                    setTimeout(start, 5000);
                }
            };

            connection.on("Notify", function (user, message) {
                $('#discussion').append(user + '<br />');
            });

            connection.on("Update", function (user, message) {

                var listItem = $("ul").first();

                if (listItem) {
                   listItem.html(user + '<br />');
                } else {
                    $('#header').append(user + '<br />');
                }
                
            });

            connection.onclose(start);

            // Start the connection.
            start();


        });
    </script>


    <script>
        var p = new PlaceObj();


    </script>
</head>
<body>


    <div id="map"></div>
    
    
    
  
    <div class="container-fluid">
        <h2>FTM Data Manager</h2>
        <br>
        <div class="row">
            <div class="col">Place Cache Operations</div>
        </div>
        <br>

        <div class="row">
            <div class="col"><a href="#Foo" onclick="p.addResetMissingPlaces();">Add and Reset Missing Places in FTMPlaceCache</a></div>
            <div class="col"><a href="#Foo" onclick="p.getUnEncodedLocationsFromServer();">GeoCode Location entries </a><div id="geocodecount" style="display:inline">0</div></div>
        </div>
        <br>
        <div class="row">
            <div class="col"><a href="#Foo" onclick="p.countOfUnknownLocations();">Update count of locations that have not been GEOCoded - </a><div id="count" style="display:inline">0</div></div>
            <div class="col"><a href="#Foo" onclick="p.updatePlaceMetadata();">Update FTM Cache MetaData</a></div>
        </div>

        <br>
        <div class="row">
            <div class="col">Add Facts to FTM DB</div>
        </div>
        <br>
        <div class="row">
            <div class="col"><a href="#Foo" onclick="p.clearData();">1.Clear Data</a></div>
            <div class="col"><a href="#Foo" onclick="p.setOriginPerson();">2.Cache Person Tree Info</a></div>
        </div>
        <br>

        <div class="row">
            <div class="col">Create data views</div>
        </div>
        <br>
        <div class="row">
            <div class="col"><a href="#Foo" onclick="p.setDateLocPop();">1. Create FTM person View</a></div>
            <div class="col"><a href="#Foo" onclick="p.createDupeView();">2. Create Dupe Entry View</a></div>

        </div>
        <br>
        <div class="row">
            <div class="col"><a href="#Foo" onclick="p.createTreeRecord();">3. Create Tree Record View</a></div>
            <div class="col"><a href="#Foo" onclick="p.azureimport();">4. Import to azure</a></div>
        </div>

        <br>
        <div class="row">
            <div class="col">Console</div>
        </div>

        <div class="row" style="background-color: black; margin-left: 1px; margin-right: 1px;">
            <div class="col"><ul id="header" style="color: green; background-color: black; font-weight: 600; padding-left: 1px"></ul></div>
        </div>

        <div class="row" style="background-color: black; margin-left: 1px; margin-right: 1px;">
            <div class="col"><ul id="discussion" style="color: green; background-color: black;  font-weight: 600; padding-left: 1px"></ul></div>
        </div>

        <div class="row">
            <div id="output"></div>
        </div>
        <div class="row">
            <div id="progress"></div>
        </div>

    </div>

</body>
</html>